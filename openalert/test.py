import json


alerts = [{"@timestamp": "2024-12-19T08:28:30.198270+00:00", "metadata": {"_index": ".ds-cmccs-logs-nginx.access-default-000001", "_id": "sYDqtJMB7K7i72bQ2itJ"}, "rule": {"name": "Detects data encoding in network traffic", "id": "cbcb94e7-efee-4854-85b1-10fc61abe912", "description": "Detects data encoding in network traffic", "risk_score": 20, "severity_label": "low", "tags": ["tags 1"], "threat": [{"framework": "MITRE ATT&CK", "tactic": {"id": "TA0011", "name": "Command and Control", "reference": "https://attack.mitre.org/tactics/TA0011/"}, "technique": [{"id": "T1132", "name": "Data Encoding", "reference": "https://attack.mitre.org/techniques/T1132/", "subTechnique": [{"id": "T1132.002", "name": "Non-Standard Encoding", "reference": "https://attack.mitre.org/techniques/T1132/002/"}]}]}]}, "event": {"match": {"agent": {"hostname": "app-lms", "ip": "192.168.0.190", "name": "cmcuni-app-07-ecs-qldt", "id": "031", "type": "filebeat", "ephemeral_id": "8b536275-a3cc-4293-8668-8665048d0b88", "version": "7.17.15"}}}}, {"@timestamp": "2024-12-19T08:28:30.198270+00:00", "metadata": {"_index": ".ds-cmccs-logs-nginx.access-default-000001", "_id": "toDqtJMB7K7i72bQ3itE"}, "rule": {"name": "Detects data encoding in network traffic", "id": "cbcb94e7-efee-4854-85b1-10fc61abe912", "description": "Detects data encoding in network traffic", "risk_score": 20, "severity_label": "low", "tags": ["tags 1"], "threat": [{"framework": "MITRE ATT&CK", "tactic": {"id": "TA0011", "name": "Command and Control", "reference": "https://attack.mitre.org/tactics/TA0011/"}, "technique": [{"id": "T1132", "name": "Data Encoding", "reference": "https://attack.mitre.org/techniques/T1132/", "subTechnique": [{"id": "T1132.002", "name": "Non-Standard Encoding", "reference": "https://attack.mitre.org/techniques/T1132/002/"}]}]}]}, "event": {"match": {"agent": {"hostname": "app-lms", "ip": "192.168.0.190", "name": "cmcuni-app-07-ecs-qldt", "id": "031", "type": "filebeat", "ephemeral_id": "8b536275-a3cc-4293-8668-8665048d0b88", "version": "7.17.15"}}}}, {"@timestamp": "2024-12-19T08:28:30.198270+00:00", "metadata": {"_index": ".ds-cmccs-logs-nginx.access-default-000001", "_id": "uoDqtJMB7K7i72bQ3ivi"}, "rule": {"name": "Detects data encoding in network traffic", "id": "cbcb94e7-efee-4854-85b1-10fc61abe912", "description": "Detects data encoding in network traffic", "risk_score": 20, "severity_label": "low", "tags": ["tags 1"], "threat": [{"framework": "MITRE ATT&CK", "tactic": {"id": "TA0011", "name": "Command and Control", "reference": "https://attack.mitre.org/tactics/TA0011/"}, "technique": [{"id": "T1132", "name": "Data Encoding", "reference": "https://attack.mitre.org/techniques/T1132/", "subTechnique": [{"id": "T1132.002", "name": "Non-Standard Encoding", "reference": "https://attack.mitre.org/techniques/T1132/002/"}]}]}]}, "event": {"match": {"agent": {"hostname": "app-lms", "ip": "192.168.0.190", "name": "cmcuni-app-07-ecs-qldt", "id": "031", "type": "filebeat", "ephemeral_id": "8b536275-a3cc-4293-8668-8665048d0b88", "version": "7.17.15"}, "@index": 2}}}, {"@timestamp": "2024-12-19T08:28:30.198270+00:00", "metadata": {"_index": ".ds-cmccs-logs-nginx.access-default-000001", "_id": "voDqtJMB7K7i72bQ3ytL"}, "rule": {"name": "Detects data encoding in network traffic", "id": "cbcb94e7-efee-4854-85b1-10fc61abe912", "description": "Detects data encoding in network traffic", "risk_score": 20, "severity_label": "low", "tags": ["tags 1"], "threat": [{"framework": "MITRE ATT&CK", "tactic": {"id": "TA0011", "name": "Command and Control", "reference": "https://attack.mitre.org/tactics/TA0011/"}, "technique": [{"id": "T1132", "name": "Data Encoding", "reference": "https://attack.mitre.org/techniques/T1132/", "subTechnique": [{"id": "T1132.002", "name": "Non-Standard Encoding", "reference": "https://attack.mitre.org/techniques/T1132/002/"}]}]}]}, "event": {"match": {"agent": {"hostname": "app-lms", "ip": "192.168.0.190", "name": "cmcuni-app-07-ecs-qldt", "id": "031", "type": "filebeat", "ephemeral_id": "8b536275-a3cc-4293-8668-8665048d0b88", "version": "7.17.15"}}}}, {"@timestamp": "2024-12-19T08:28:30.198270+00:00", "metadata": {"_index": ".ds-cmccs-logs-nginx.access-default-000001", "_id": "Auh03JMB8sX7qvLszQ7G"}, "rule": {"name": "Detects data encoding in network traffic", "id": "cbcb94e7-efee-4854-85b1-10fc61abe912", "description": "Detects data encoding in network traffic", "risk_score": 20, "severity_label": "low", "tags": ["tags 1"], "threat": [{"framework": "MITRE ATT&CK", "tactic": {"id": "TA0011", "name": "Command and Control", "reference": "https://attack.mitre.org/tactics/TA0011/"}, "technique": [{"id": "T1132", "name": "Data Encoding", "reference": "https://attack.mitre.org/techniques/T1132/", "subTechnique": [{"id": "T1132.002", "name": "Non-Standard Encoding", "reference": "https://attack.mitre.org/techniques/T1132/002/"}]}]}]}, "event": {"match": {"agent": {"hostname": "app-lms", "ip": "192.168.0.190", "name": "cmcuni-app-07-ecs-qldt", "id": "031", "type": "filebeat", "ephemeral_id": "8b536275-a3cc-4293-8668-8665048d0b88", "version": "7.17.15"}}}}, {"@timestamp": "2024-12-19T08:28:30.198270+00:00", "metadata": {"_index": ".ds-cmccs-logs-nginx.access-default-000001", "_id": "B-h03JMB8sX7qvLszw5O"}, "rule": {"name": "Detects data encoding in network traffic", "id": "cbcb94e7-efee-4854-85b1-10fc61abe912", "description": "Detects data encoding in network traffic", "risk_score": 20, "severity_label": "low", "tags": ["tags 1"], "threat": [{"framework": "MITRE ATT&CK", "tactic": {"id": "TA0011", "name": "Command and Control", "reference": "https://attack.mitre.org/tactics/TA0011/"}, "technique": [{"id": "T1132", "name": "Data Encoding", "reference": "https://attack.mitre.org/techniques/T1132/", "subTechnique": [{"id": "T1132.002", "name": "Non-Standard Encoding", "reference": "https://attack.mitre.org/techniques/T1132/002/"}]}]}]}, "event": {"match": {"agent": {"hostname": "app-lms", "ip": "192.168.0.190", "name": "cmcuni-app-07-ecs-qldt", "id": "031", "type": "filebeat", "ephemeral_id": "8b536275-a3cc-4293-8668-8665048d0b88", "version": "7.17.15"}}}}, {"@timestamp": "2024-12-19T08:28:30.198270+00:00", "metadata": {"_index": ".ds-cmccs-logs-nginx.access-default-000001", "_id": "C-h03JMB8sX7qvLs0Q4q"}, "rule": {"name": "Detects data encoding in network traffic", "id": "cbcb94e7-efee-4854-85b1-10fc61abe912", "description": "Detects data encoding in network traffic", "risk_score": 20, "severity_label": "low", "tags": ["tags 1"], "threat": [{"framework": "MITRE ATT&CK", "tactic": {"id": "TA0011", "name": "Command and Control", "reference": "https://attack.mitre.org/tactics/TA0011/"}, "technique": [{"id": "T1132", "name": "Data Encoding", "reference": "https://attack.mitre.org/techniques/T1132/", "subTechnique": [{"id": "T1132.002", "name": "Non-Standard Encoding", "reference": "https://attack.mitre.org/techniques/T1132/002/"}]}]}]}, "event": {"match": {"agent": {"hostname": "app-lms", "ip": "192.168.0.190", "name": "cmcuni-app-07-ecs-qldt", "id": "031", "type": "filebeat", "ephemeral_id": "8b536275-a3cc-4293-8668-8665048d0b88", "version": "7.17.15"}, "@index": 6}}}, {"@timestamp": "2024-12-19T08:28:30.198270+00:00", "metadata": {"_index": ".ds-cmccs-logs-nginx.access-default-000001", "_id": "D-h03JMB8sX7qvLs0g60"}, "rule": {"name": "Detects data encoding in network traffic", "id": "cbcb94e7-efee-4854-85b1-10fc61abe912", "description": "Detects data encoding in network traffic", "risk_score": 20, "severity_label": "low", "tags": ["tags 1"], "threat": [{"framework": "MITRE ATT&CK", "tactic": {"id": "TA0011", "name": "Command and Control", "reference": "https://attack.mitre.org/tactics/TA0011/"}, "technique": [{"id": "T1132", "name": "Data Encoding", "reference": "https://attack.mitre.org/techniques/T1132/", "subTechnique": [{"id": "T1132.002", "name": "Non-Standard Encoding", "reference": "https://attack.mitre.org/techniques/T1132/002/"}]}]}]}, "event": {"match": {"agent": {"hostname": "app-lms", "ip": "192.168.0.190", "name": "cmcuni-app-07-ecs-qldt", "id": "031", "type": "filebeat", "ephemeral_id": "8b536275-a3cc-4293-8668-8665048d0b88", "version": "7.17.15"}}}}, {"@timestamp": "2024-12-19T08:28:30.198270+00:00", "metadata": {"_index": ".ds-cmccs-logs-nginx.access-default-000001", "_id": "E-h03JMB8sX7qvLs1A5m"}, "rule": {"name": "Detects data encoding in network traffic", "id": "cbcb94e7-efee-4854-85b1-10fc61abe912", "description": "Detects data encoding in network traffic", "risk_score": 20, "severity_label": "low", "tags": ["tags 1"], "threat": [{"framework": "MITRE ATT&CK", "tactic": {"id": "TA0011", "name": "Command and Control", "reference": "https://attack.mitre.org/tactics/TA0011/"}, "technique": [{"id": "T1132", "name": "Data Encoding", "reference": "https://attack.mitre.org/techniques/T1132/", "subTechnique": [{"id": "T1132.002", "name": "Non-Standard Encoding", "reference": "https://attack.mitre.org/techniques/T1132/002/"}]}]}]}, "event": {"match": {"agent": {"hostname": "app-lms", "ip": "192.168.0.190", "name": "cmcuni-app-07-ecs-qldt", "id": "031", "type": "filebeat", "ephemeral_id": "8b536275-a3cc-4293-8668-8665048d0b88", "version": "7.17.15"}, "@index": 8}}}, {"@timestamp": "2024-12-19T08:28:30.198270+00:00", "metadata": {"_index": ".ds-cmccs-logs-nginx.access-default-000001", "_id": "F-h03JMB8sX7qvLs1g49"}, "rule": {"name": "Detects data encoding in network traffic", "id": "cbcb94e7-efee-4854-85b1-10fc61abe912", "description": "Detects data encoding in network traffic", "risk_score": 20, "severity_label": "low", "tags": ["tags 1"], "threat": [{"framework": "MITRE ATT&CK", "tactic": {"id": "TA0011", "name": "Command and Control", "reference": "https://attack.mitre.org/tactics/TA0011/"}, "technique": [{"id": "T1132", "name": "Data Encoding", "reference": "https://attack.mitre.org/techniques/T1132/", "subTechnique": [{"id": "T1132.002", "name": "Non-Standard Encoding", "reference": "https://attack.mitre.org/techniques/T1132/002/"}]}]}]}, "event": {"match": {"agent": {"hostname": "app-lms", "ip": "192.168.0.190", "name": "cmcuni-app-07-ecs-qldt", "id": "031", "type": "filebeat", "ephemeral_id": "8b536275-a3cc-4293-8668-8665048d0b88", "version": "7.17.15"}}}}]

# alerts = [alert for alert in alerts if '@index' in alert['event']['match']]
# alerts = [
#     {**alert, "event": {**alert["event"], "match": {k: v for k, v in alert["event"]["match"].items() if k != "@index"}}}
#     for alert in alerts
#     if '@index' in alert['event']['match']
# ]

alerts = [
    alert for alert in alerts
    if '@index' in alert['event']['match'] and alert['event']['match'].pop('@index', None) is not None
]

print(json.dumps(alerts))